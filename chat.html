<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secret Friend Chat</title>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
</head>
<body>
<div class="container">
  <h1>Secret Friend Chat</h1>
  <div id="chatWindow"></div>
  <input type="text" id="chatInput" placeholder="Type your message">
  <button id="sendBtn">Send</button>
</div>

<script>
const chatWindow = document.getElementById("chatWindow");
const chatInput = document.getElementById("chatInput");
const sendBtn = document.getElementById("sendBtn");

// Placeholder user & match IDs (replace with real after login/match)
let currentUserId = localStorage.getItem("userId");
let matchId = localStorage.getItem("matchId");

const chatRef = db.collection("chats").where("matchId","==",matchId).orderBy("timestamp");

chatRef.onSnapshot((snap)=>{
  chatWindow.innerHTML="";
  snap.forEach(doc=>{
    const m = doc.data();
    const div = document.createElement("div");
    div.className = m.senderId===currentUserId ? "myMsg":"otherMsg";
    div.innerText = m.message;
    chatWindow.appendChild(div);
  });
  chatWindow.scrollTop = chatWindow.scrollHeight;
});

sendBtn.addEventListener("click", async()=>{
  const msg = chatInput.value.trim();
  if(!msg) return;
  await db.collection("chats").add({
    matchId,
    senderId: currentUserId,
    message: msg,
    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
    read: false
  });
  chatInput.value="";
});
</script>
</body>
</html>
